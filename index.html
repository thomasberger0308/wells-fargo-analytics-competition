<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Wells-fargo-analytics-competition by thomasberger0308</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-dark.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/main.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>

      <header>
        <h1>Wells-fargo-analytics-competition</h1>
        <p></p>
      </header>

      <div id="banner">
        <span id="logo"></span>

        <a href="https://github.com/thomasberger0308/wells-fargo-analytics-competition" class="button fork"><strong>View On GitHub</strong></a>
        <div class="downloads">
          <span>Downloads:</span>
          <ul>
            <li><a href="https://github.com/thomasberger0308/wells-fargo-analytics-competition/zipball/master" class="button">ZIP</a></li>
            <li><a href="https://github.com/thomasberger0308/wells-fargo-analytics-competition/tarball/master" class="button">TAR</a></li>
          </ul>
        </div>
      </div><!-- end banner -->

    <div class="wrapper">
      <nav>
        <ul></ul>
      </nav>
      <section>
        <p>This page documents the result of the Wells Fargo competition "Use social data to identify drivers of online conversations". At this competition a data-set with 220,377 Twitter and Facebook messages was provided and has been analyzed as seen in the following steps.</p>

<h1>
<a id="big-picture" class="anchor" href="#big-picture" aria-hidden="true"><span class="octicon octicon-link"></span></a>Big Picture</h1>

<p>The following picture gives an overview about data processing  steps
<img src="http://i.imgur.com/Nl1vUOr.png" alt=""></p>

<h1>
<a id="loading-and-filtering" class="anchor" href="#loading-and-filtering" aria-hidden="true"><span class="octicon octicon-link"></span></a>Loading and Filtering</h1>

<h2>
<a id="load-data" class="anchor" href="#load-data" aria-hidden="true"><span class="octicon octicon-link"></span></a>Load Data</h2>

<div class="highlight highlight-source-r"><pre>library(<span class="pl-smi">tm</span>) 
library(<span class="pl-smi">rpart</span>)

<span class="pl-c"># Create data frame of dataset</span>
<span class="pl-v">df</span> <span class="pl-k">=</span> read.table(<span class="pl-s"><span class="pl-pds">'</span>dataset.txt<span class="pl-pds">'</span></span>,<span class="pl-v">sep</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>|<span class="pl-pds">"</span></span>,<span class="pl-v">header</span><span class="pl-k">=</span><span class="pl-c1">T</span>)

<span class="pl-c"># change column 'FullText' to character</span>
<span class="pl-smi">df</span><span class="pl-k">$</span><span class="pl-v">FullText</span> <span class="pl-k">=</span> as.character(<span class="pl-smi">df</span><span class="pl-k">$</span><span class="pl-smi">FullText</span>)

<span class="pl-c"># Remove non-ascii characters</span>
<span class="pl-v">df.texts.clean</span> <span class="pl-k">=</span> as.data.frame(iconv(<span class="pl-smi">df</span><span class="pl-k">$</span><span class="pl-smi">FullText</span>, <span class="pl-s"><span class="pl-pds">"</span>latin1<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>ASCII<span class="pl-pds">"</span></span>, <span class="pl-v">sub</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>))
colnames(<span class="pl-smi">df.texts.clean</span>) <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>FullText<span class="pl-pds">'</span></span>
<span class="pl-smi">df</span><span class="pl-k">$</span><span class="pl-v">FullText</span> <span class="pl-k">=</span> <span class="pl-smi">df.texts.clean</span><span class="pl-k">$</span><span class="pl-smi">FullText</span>
rm(<span class="pl-smi">df.texts.clean</span>)

<span class="pl-c"># change content of column 'Fulltext' to lowercase</span>
<span class="pl-smi">df</span><span class="pl-k">$</span><span class="pl-v">FullText</span> <span class="pl-k">=</span> tolower(<span class="pl-smi">df</span><span class="pl-k">$</span><span class="pl-smi">FullText</span>)</pre></div>

<h2>
<a id="filter-banks" class="anchor" href="#filter-banks" aria-hidden="true"><span class="octicon octicon-link"></span></a>Filter Banks</h2>

<div class="highlight highlight-source-r"><pre><span class="pl-c"># Filter banks</span>
<span class="pl-v">bankA.idx</span> <span class="pl-k">=</span> which(sapply(<span class="pl-smi">df</span><span class="pl-k">$</span><span class="pl-smi">FullText</span>,<span class="pl-k">function</span>(<span class="pl-smi">x</span>) grepl(<span class="pl-s"><span class="pl-pds">"</span>banka<span class="pl-pds">"</span></span>,<span class="pl-smi">x</span>)))
<span class="pl-v">bankB.idx</span> <span class="pl-k">=</span> which(sapply(<span class="pl-smi">df</span><span class="pl-k">$</span><span class="pl-smi">FullText</span>,<span class="pl-k">function</span>(<span class="pl-smi">x</span>) grepl(<span class="pl-s"><span class="pl-pds">"</span>bankb<span class="pl-pds">"</span></span>,<span class="pl-smi">x</span>)))
<span class="pl-v">bankC.idx</span> <span class="pl-k">=</span> which(sapply(<span class="pl-smi">df</span><span class="pl-k">$</span><span class="pl-smi">FullText</span>,<span class="pl-k">function</span>(<span class="pl-smi">x</span>) grepl(<span class="pl-s"><span class="pl-pds">"</span>bankc<span class="pl-pds">"</span></span>,<span class="pl-smi">x</span>)))
<span class="pl-v">bankD.idx</span> <span class="pl-k">=</span> which(sapply(<span class="pl-smi">df</span><span class="pl-k">$</span><span class="pl-smi">FullText</span>,<span class="pl-k">function</span>(<span class="pl-smi">x</span>) grepl(<span class="pl-s"><span class="pl-pds">"</span>bankd<span class="pl-pds">"</span></span>,<span class="pl-smi">x</span>)))

<span class="pl-c"># Enter new column with bank name</span>
<span class="pl-c"># initialize with 'No'</span>
<span class="pl-smi">df</span><span class="pl-k">$</span><span class="pl-v">BankID</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>No<span class="pl-pds">"</span></span>
<span class="pl-smi">df</span><span class="pl-k">$</span><span class="pl-smi">BankID</span>[<span class="pl-smi">bankA.idx</span>] <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>BankA<span class="pl-pds">"</span></span>
<span class="pl-smi">df</span><span class="pl-k">$</span><span class="pl-smi">BankID</span>[<span class="pl-smi">bankB.idx</span>] <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>BankB<span class="pl-pds">"</span></span>
<span class="pl-smi">df</span><span class="pl-k">$</span><span class="pl-smi">BankID</span>[<span class="pl-smi">bankC.idx</span>] <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>BankC<span class="pl-pds">"</span></span>
<span class="pl-smi">df</span><span class="pl-k">$</span><span class="pl-smi">BankID</span>[<span class="pl-smi">bankD.idx</span>] <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>BankD<span class="pl-pds">"</span></span>

<span class="pl-c"># remove messages where BankA, BankB, BankC or BankD is not mentioned</span>
<span class="pl-smi">df</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">df</span>[<span class="pl-k">-</span>which(<span class="pl-smi">df</span><span class="pl-k">$</span><span class="pl-smi">BankID</span><span class="pl-k">==</span><span class="pl-s"><span class="pl-pds">'</span>No<span class="pl-pds">'</span></span>), ]</pre></div>

<h2>
<a id="filter-topics" class="anchor" href="#filter-topics" aria-hidden="true"><span class="octicon octicon-link"></span></a>Filter Topics</h2>

<div class="highlight highlight-source-r"><pre><span class="pl-c"># find messages with the topic 'atm'</span>
<span class="pl-v">atm.idx</span> <span class="pl-k">=</span> which(sapply(<span class="pl-smi">df</span><span class="pl-k">$</span><span class="pl-smi">FullText</span>,<span class="pl-k">function</span>(<span class="pl-smi">x</span>) grepl(<span class="pl-s"><span class="pl-pds">"</span>atm<span class="pl-pds">"</span></span>,<span class="pl-smi">x</span>)))

<span class="pl-c"># find messages with the topic 'online'</span>
<span class="pl-v">online1.idx</span> <span class="pl-k">=</span> which(sapply(<span class="pl-smi">df</span><span class="pl-k">$</span><span class="pl-smi">FullText</span>,<span class="pl-k">function</span>(<span class="pl-smi">x</span>) grepl(<span class="pl-s"><span class="pl-pds">"</span>online<span class="pl-pds">"</span></span>,<span class="pl-smi">x</span>)))
<span class="pl-v">online2.idx</span> <span class="pl-k">=</span> which(sapply(<span class="pl-smi">df</span><span class="pl-k">$</span><span class="pl-smi">FullText</span>,<span class="pl-k">function</span>(<span class="pl-smi">x</span>) grepl(<span class="pl-s"><span class="pl-pds">"</span>app<span class="pl-pds">"</span></span>,<span class="pl-smi">x</span>)))

<span class="pl-c"># find messages with the topic 'investment'</span>
<span class="pl-v">investment1.idx</span> <span class="pl-k">=</span> which(sapply(<span class="pl-smi">df</span><span class="pl-k">$</span><span class="pl-smi">FullText</span>,<span class="pl-k">function</span>(<span class="pl-smi">x</span>) grepl(<span class="pl-s"><span class="pl-pds">"</span>investor<span class="pl-pds">"</span></span>,<span class="pl-smi">x</span>)))
<span class="pl-v">investment2.idx</span> <span class="pl-k">=</span> which(sapply(<span class="pl-smi">df</span><span class="pl-k">$</span><span class="pl-smi">FullText</span>,<span class="pl-k">function</span>(<span class="pl-smi">x</span>) grepl(<span class="pl-s"><span class="pl-pds">"</span>investment<span class="pl-pds">"</span></span>,<span class="pl-smi">x</span>)))

<span class="pl-c"># find messages with the topic 'fraud'</span>
<span class="pl-v">fraud.idx</span> <span class="pl-k">=</span> which(sapply(<span class="pl-smi">df</span><span class="pl-k">$</span><span class="pl-smi">FullText</span>,<span class="pl-k">function</span>(<span class="pl-smi">x</span>) grepl(<span class="pl-s"><span class="pl-pds">"</span>fraud<span class="pl-pds">"</span></span>,<span class="pl-smi">x</span>)))

<span class="pl-c"># find messages with the topic 'service'</span>
<span class="pl-v">service.idx</span> <span class="pl-k">=</span> which(sapply(<span class="pl-smi">df</span><span class="pl-k">$</span><span class="pl-smi">FullText</span>,<span class="pl-k">function</span>(<span class="pl-smi">x</span>) grepl(<span class="pl-s"><span class="pl-pds">"</span>service<span class="pl-pds">"</span></span>,<span class="pl-smi">x</span>)))

<span class="pl-c"># find messages with the topic 'fee'</span>
<span class="pl-v">fee.idx</span> <span class="pl-k">=</span> which(sapply(<span class="pl-smi">df</span><span class="pl-k">$</span><span class="pl-smi">FullText</span>,<span class="pl-k">function</span>(<span class="pl-smi">x</span>) grepl(<span class="pl-s"><span class="pl-pds">"</span>fee<span class="pl-pds">"</span></span>,<span class="pl-smi">x</span>)))

<span class="pl-c"># find messages with the topic 'job'</span>
<span class="pl-v">job1.idx</span> <span class="pl-k">=</span> which(sapply(<span class="pl-smi">df</span><span class="pl-k">$</span><span class="pl-smi">FullText</span>,<span class="pl-k">function</span>(<span class="pl-smi">x</span>) grepl(<span class="pl-s"><span class="pl-pds">"</span>interview<span class="pl-pds">"</span></span>,<span class="pl-smi">x</span>)))
<span class="pl-v">job2.idx</span> <span class="pl-k">=</span> which(sapply(<span class="pl-smi">df</span><span class="pl-k">$</span><span class="pl-smi">FullText</span>,<span class="pl-k">function</span>(<span class="pl-smi">x</span>) grepl(<span class="pl-s"><span class="pl-pds">"</span>recruiting<span class="pl-pds">"</span></span>,<span class="pl-smi">x</span>)))
<span class="pl-v">job3.idx</span> <span class="pl-k">=</span> which(sapply(<span class="pl-smi">df</span><span class="pl-k">$</span><span class="pl-smi">FullText</span>,<span class="pl-k">function</span>(<span class="pl-smi">x</span>) grepl(<span class="pl-s"><span class="pl-pds">"</span>recruitment<span class="pl-pds">"</span></span>,<span class="pl-smi">x</span>)))
<span class="pl-v">job4.idx</span> <span class="pl-k">=</span> which(sapply(<span class="pl-smi">df</span><span class="pl-k">$</span><span class="pl-smi">FullText</span>,<span class="pl-k">function</span>(<span class="pl-smi">x</span>) grepl(<span class="pl-s"><span class="pl-pds">"</span>job<span class="pl-pds">"</span></span>,<span class="pl-smi">x</span>)))


<span class="pl-c"># Enter new column with topics</span>

<span class="pl-c"># initialize with 'No'</span>
<span class="pl-smi">df</span><span class="pl-k">$</span><span class="pl-v">Label</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>No<span class="pl-pds">"</span></span>
</pre></div>

<h2>
<a id="rstudio-demo" class="anchor" href="#rstudio-demo" aria-hidden="true"><span class="octicon octicon-link"></span></a>RStudio Demo</h2>

<p><iframe width="560" height="315" src="https://www.youtube.com/embed/81EHUXZZkfE" frameborder="0" allowfullscreen></iframe></p>

<h1>
<a id="word-cloud" class="anchor" href="#word-cloud" aria-hidden="true"><span class="octicon octicon-link"></span></a>Word Cloud</h1>

<h2>
<a id="source-code" class="anchor" href="#source-code" aria-hidden="true"><span class="octicon octicon-link"></span></a>Source Code</h2>

<div class="highlight highlight-source-r"><pre><span class="pl-c"># since it is very slow otherwise, make the dataset smaller</span>
<span class="pl-v">idx.10000</span> <span class="pl-k">=</span> sample(<span class="pl-c1">1</span><span class="pl-k">:</span>nrow(<span class="pl-smi">df</span>),<span class="pl-c1">10000</span>)
<span class="pl-v">df.10000</span> <span class="pl-k">=</span> <span class="pl-smi">df</span>[<span class="pl-smi">idx.10000</span>,]

<span class="pl-c"># create a corpus from data frame</span>
<span class="pl-smi">docs</span> <span class="pl-k">&lt;-</span> Corpus(DataframeSource(as.data.frame(<span class="pl-smi">df.10000</span>[,<span class="pl-c1">6</span>]))) 

<span class="pl-c"># Removing punctuation</span>
<span class="pl-smi">docs</span> <span class="pl-k">&lt;-</span> tm_map(<span class="pl-smi">docs</span>, <span class="pl-smi">removePunctuation</span>)   
<span class="pl-c"># Removing numbers</span>
<span class="pl-smi">docs</span> <span class="pl-k">&lt;-</span> tm_map(<span class="pl-smi">docs</span>, <span class="pl-smi">removeNumbers</span>) 
<span class="pl-c">#Converting to lowercase</span>
<span class="pl-smi">docs</span> <span class="pl-k">&lt;-</span> tm_map(<span class="pl-smi">docs</span>, <span class="pl-smi">tolower</span>)
<span class="pl-c">#Removing “stopwords” (common words) that usually have no analytic value.</span>
<span class="pl-smi">docs</span> <span class="pl-k">&lt;-</span> tm_map(<span class="pl-smi">docs</span>, <span class="pl-smi">removeWords</span>, stopwords(<span class="pl-s"><span class="pl-pds">"</span>english<span class="pl-pds">"</span></span>))   
<span class="pl-c">#Removing particular words</span>
<span class="pl-smi">docs</span> <span class="pl-k">&lt;-</span> tm_map(<span class="pl-smi">docs</span>, <span class="pl-smi">removeWords</span>, c(<span class="pl-s"><span class="pl-pds">"</span>banka<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>bankb<span class="pl-pds">"</span></span>,<span class="pl-s"><span class="pl-pds">"</span>bankc<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>bankd<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>bank<span class="pl-pds">"</span></span>, 
                                    <span class="pl-s"><span class="pl-pds">"</span>twithndl<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>twithndlbanka<span class="pl-pds">"</span></span>,<span class="pl-s"><span class="pl-pds">"</span>twithndlbanka<span class="pl-pds">"</span></span>,<span class="pl-s"><span class="pl-pds">"</span>twithndlbankb<span class="pl-pds">"</span></span>,
                                    <span class="pl-s"><span class="pl-pds">"</span>twithndlbankc<span class="pl-pds">"</span></span>,<span class="pl-s"><span class="pl-pds">"</span>twithndlbankd<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>,<span class="pl-s"><span class="pl-pds">"</span>rettwit<span class="pl-pds">"</span></span>,<span class="pl-s"><span class="pl-pds">"</span>http<span class="pl-pds">"</span></span>)) 
<span class="pl-c">#Removing common word endings (e.g., “ing”, “es”, “s”)</span>
library(<span class="pl-smi">SnowballC</span>)   
<span class="pl-smi">docs</span> <span class="pl-k">&lt;-</span> tm_map(<span class="pl-smi">docs</span>, <span class="pl-smi">stemDocument</span>)  
<span class="pl-c">#Stripping unnecesary whitespace</span>
<span class="pl-smi">docs</span> <span class="pl-k">&lt;-</span> tm_map(<span class="pl-smi">docs</span>, <span class="pl-smi">stripWhitespace</span>)
<span class="pl-c">#Finish</span>
<span class="pl-smi">docs</span> <span class="pl-k">&lt;-</span> tm_map(<span class="pl-smi">docs</span>, <span class="pl-smi">PlainTextDocument</span>) 

<span class="pl-c">#create a document term matrix</span>
<span class="pl-smi">dtm</span> <span class="pl-k">&lt;-</span> DocumentTermMatrix(<span class="pl-smi">docs</span>)
<span class="pl-c">#transpose of this matrix</span>
<span class="pl-smi">tdm</span> <span class="pl-k">&lt;-</span> TermDocumentMatrix(<span class="pl-smi">docs</span>) 

<span class="pl-c">#  Start by removing sparse terms:   </span>
<span class="pl-smi">dtms</span> <span class="pl-k">&lt;-</span> removeSparseTerms(<span class="pl-smi">dtm</span>, <span class="pl-c1">0.1</span>)    

<span class="pl-c"># Organize terms by their frequency</span>
<span class="pl-smi">freq</span> <span class="pl-k">&lt;-</span> colSums(as.matrix(<span class="pl-smi">dtm</span>))  
<span class="pl-smi">ord</span> <span class="pl-k">&lt;-</span> order(<span class="pl-smi">freq</span>)   
<span class="pl-c">#  Start by removing sparse terms:   </span>
<span class="pl-smi">dtms</span> <span class="pl-k">&lt;-</span> removeSparseTerms(<span class="pl-smi">dtm</span>, <span class="pl-c1">0.1</span>) 

<span class="pl-c">#Word Cloud 100 most words</span>
set.seed(<span class="pl-c1">142</span>)   
<span class="pl-smi">dark2</span> <span class="pl-k">&lt;-</span> brewer.pal(<span class="pl-c1">6</span>, <span class="pl-s"><span class="pl-pds">"</span>Dark2<span class="pl-pds">"</span></span>)   
wordcloud(names(<span class="pl-smi">freq</span>), <span class="pl-smi">freq</span>, <span class="pl-v">max.words</span><span class="pl-k">=</span><span class="pl-c1">100</span>, <span class="pl-v">rot.per</span><span class="pl-k">=</span><span class="pl-c1">0.2</span>, <span class="pl-v">colors</span><span class="pl-k">=</span><span class="pl-smi">dark2</span>)   </pre></div>

<h2>
<a id="result" class="anchor" href="#result" aria-hidden="true"><span class="octicon octicon-link"></span></a>Result</h2>

<p><img src="http://i.imgur.com/B9HMQbG.png" alt=""></p>

<h1>
<a id="sentiment" class="anchor" href="#sentiment" aria-hidden="true"><span class="octicon octicon-link"></span></a>Sentiment</h1>

<h2>
<a id="source-code-1" class="anchor" href="#source-code-1" aria-hidden="true"><span class="octicon octicon-link"></span></a>Source Code</h2>

<div class="highlight highlight-source-r"><pre><span class="pl-c"># Based on: http://www.ihub.co.ke/blogs/23216</span>

<span class="pl-c"># Only need to do once</span>
<span class="pl-c"># Download and upload: http://www.cs.uic.edu/~liub/FBS/opinion-lexicon-English.rar</span>
<span class="pl-c">#system('unrar e opinion-lexicon-English.rar')</span>

<span class="pl-smi">pos</span> <span class="pl-k">&lt;-</span> scan(<span class="pl-s"><span class="pl-pds">'</span>positive-words.txt<span class="pl-pds">'</span></span>,<span class="pl-v">what</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>character<span class="pl-pds">'</span></span>,<span class="pl-v">comment.char</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>;<span class="pl-pds">'</span></span>)
<span class="pl-smi">neg</span> <span class="pl-k">&lt;-</span> scan(<span class="pl-s"><span class="pl-pds">'</span>negative-words.txt<span class="pl-pds">'</span></span>,<span class="pl-v">what</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>character<span class="pl-pds">'</span></span>,<span class="pl-v">comment.char</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>;<span class="pl-pds">'</span></span>)

<span class="pl-v">score.sentiment</span> <span class="pl-k">=</span> <span class="pl-k">function</span>(<span class="pl-smi">sentences</span>, <span class="pl-smi">pos.words</span>, <span class="pl-smi">neg.words</span>, <span class="pl-v">.progress</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>none<span class="pl-pds">'</span></span>)
{
  require(<span class="pl-smi">plyr</span>)
  require(<span class="pl-smi">stringr</span>)

  <span class="pl-c"># we got a vector of sentences. plyr will handle a list</span>
  <span class="pl-c"># or a vector as an "l" for us</span>
  <span class="pl-c"># we want a simple array ("a") of scores back, so we use </span>
  <span class="pl-c"># "l" + "a" + "ply" = "laply":</span>
  <span class="pl-v">scores</span> <span class="pl-k">=</span> laply(<span class="pl-smi">sentences</span>, <span class="pl-k">function</span>(<span class="pl-smi">sentence</span>, <span class="pl-smi">pos.words</span>, <span class="pl-smi">neg.words</span>) {

    <span class="pl-c"># clean up sentences with R's regex-driven global substitute, gsub():</span>
    <span class="pl-v">sentence</span> <span class="pl-k">=</span> gsub(<span class="pl-s"><span class="pl-pds">'</span>[[:punct:]]<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span>, <span class="pl-smi">sentence</span>)
    <span class="pl-v">sentence</span> <span class="pl-k">=</span> gsub(<span class="pl-s"><span class="pl-pds">'</span>[[:cntrl:]]<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span>, <span class="pl-smi">sentence</span>)
    <span class="pl-v">sentence</span> <span class="pl-k">=</span> gsub(<span class="pl-s"><span class="pl-pds">'</span><span class="pl-cce">\\</span>d+<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span>, <span class="pl-smi">sentence</span>)
    <span class="pl-c"># and convert to lower case:</span>
    <span class="pl-v">sentence</span> <span class="pl-k">=</span> tolower(<span class="pl-smi">sentence</span>)

    <span class="pl-c"># split into words. str_split is in the stringr package</span>
    <span class="pl-v">word.list</span> <span class="pl-k">=</span> str_split(<span class="pl-smi">sentence</span>, <span class="pl-s"><span class="pl-pds">'</span><span class="pl-cce">\\</span>s+<span class="pl-pds">'</span></span>)
    <span class="pl-c"># sometimes a list() is one level of hierarchy too much</span>
    <span class="pl-v">words</span> <span class="pl-k">=</span> unlist(<span class="pl-smi">word.list</span>)

    <span class="pl-c"># compare our words to the dictionaries of positive &amp; negative terms</span>
    <span class="pl-v">pos.matches</span> <span class="pl-k">=</span> match(<span class="pl-smi">words</span>, <span class="pl-smi">pos.words</span>)
    <span class="pl-v">neg.matches</span> <span class="pl-k">=</span> match(<span class="pl-smi">words</span>, <span class="pl-smi">neg.words</span>)

    <span class="pl-c"># match() returns the position of the matched term or NA</span>
    <span class="pl-c"># we just want a TRUE/FALSE:</span>
    <span class="pl-v">pos.matches</span> <span class="pl-k">=</span> <span class="pl-k">!</span>is.na(<span class="pl-smi">pos.matches</span>)
    <span class="pl-v">neg.matches</span> <span class="pl-k">=</span> <span class="pl-k">!</span>is.na(<span class="pl-smi">neg.matches</span>)

    <span class="pl-c"># and conveniently enough, TRUE/FALSE will be treated as 1/0 by sum():</span>
    <span class="pl-v">score</span> <span class="pl-k">=</span> sum(<span class="pl-smi">pos.matches</span>) <span class="pl-k">-</span> sum(<span class="pl-smi">neg.matches</span>)

    <span class="pl-k">return</span>(<span class="pl-smi">score</span>)
  }, <span class="pl-smi">pos.words</span>, <span class="pl-smi">neg.words</span>, <span class="pl-v">.progress</span><span class="pl-k">=</span>.<span class="pl-smi">progress</span> )

  <span class="pl-v">scores.df</span> <span class="pl-k">=</span> <span class="pl-k">data.frame</span>(<span class="pl-v">score</span><span class="pl-k">=</span><span class="pl-smi">scores</span>, <span class="pl-v">text</span><span class="pl-k">=</span><span class="pl-smi">sentences</span>)
  <span class="pl-k">return</span>(<span class="pl-smi">scores.df</span>)
}

<span class="pl-v">df.sentiment</span> <span class="pl-k">=</span> <span class="pl-smi">df</span>[]

<span class="pl-v">scores</span> <span class="pl-k">=</span> score.sentiment(<span class="pl-smi">df.sentiment</span><span class="pl-k">$</span><span class="pl-smi">FullText</span>, <span class="pl-smi">pos</span>, <span class="pl-smi">neg</span>, <span class="pl-v">.progress</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>text<span class="pl-pds">'</span></span>)
<span class="pl-smi">scores</span><span class="pl-k">$</span><span class="pl-v">very.pos</span> <span class="pl-k">=</span> as.numeric(<span class="pl-smi">scores</span><span class="pl-k">$</span><span class="pl-smi">score</span> <span class="pl-k">&gt;</span><span class="pl-k">=</span> <span class="pl-c1">2</span>)
<span class="pl-smi">scores</span><span class="pl-k">$</span><span class="pl-v">very.neg</span> <span class="pl-k">=</span> as.numeric(<span class="pl-smi">scores</span><span class="pl-k">$</span><span class="pl-smi">score</span> <span class="pl-k">&lt;</span><span class="pl-k">=</span> <span class="pl-k">-</span><span class="pl-c1">2</span>)

<span class="pl-c"># how many very positives and very negatives</span>
<span class="pl-v">numpos</span> <span class="pl-k">=</span> sum(<span class="pl-smi">scores</span><span class="pl-k">$</span><span class="pl-smi">very.pos</span>)
<span class="pl-v">numneg</span> <span class="pl-k">=</span> sum(<span class="pl-smi">scores</span><span class="pl-k">$</span><span class="pl-smi">very.neg</span>)

<span class="pl-c"># global score</span>
<span class="pl-v">global_score</span> <span class="pl-k">=</span> round( <span class="pl-c1">100</span> <span class="pl-k">*</span> <span class="pl-smi">numpos</span> <span class="pl-k">/</span> (<span class="pl-smi">numpos</span> <span class="pl-k">+</span> <span class="pl-smi">numneg</span>) )

<span class="pl-smi">scores</span><span class="pl-k">$</span><span class="pl-v">bankid</span> <span class="pl-k">=</span> <span class="pl-smi">df.sentiment</span><span class="pl-k">$</span><span class="pl-smi">BankID</span>

<span class="pl-c"># colors</span>
<span class="pl-v">cols</span> <span class="pl-k">=</span> c(<span class="pl-s"><span class="pl-pds">"</span>#CC0000<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>#99FF00<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>#FFCC00<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>#3333FF<span class="pl-pds">"</span></span>)
names(<span class="pl-smi">cols</span>) <span class="pl-k">=</span> c(<span class="pl-s"><span class="pl-pds">"</span>BankA<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>BankB<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>BankC<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>BankD<span class="pl-pds">"</span></span>)

<span class="pl-c"># boxplot</span>
library(<span class="pl-smi">ggplot2</span>)
<span class="pl-c">#Bank's Sentiment Scores</span>
ggplot(<span class="pl-smi">scores</span>, aes(<span class="pl-v">x</span><span class="pl-k">=</span><span class="pl-smi">bankid</span>, <span class="pl-v">y</span><span class="pl-k">=</span><span class="pl-smi">score</span>, <span class="pl-v">group</span><span class="pl-k">=</span><span class="pl-smi">bankid</span>)) <span class="pl-k">+</span>
  geom_boxplot(aes(<span class="pl-v">fill</span><span class="pl-k">=</span><span class="pl-smi">bankid</span>)) <span class="pl-k">+</span>
  scale_fill_manual(<span class="pl-v">values</span><span class="pl-k">=</span><span class="pl-smi">cols</span>) <span class="pl-k">+</span>
  geom_jitter(<span class="pl-v">colour</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>gray40<span class="pl-pds">"</span></span>,<span class="pl-v">position</span><span class="pl-k">=</span>position_jitter(<span class="pl-v">width</span><span class="pl-k">=</span><span class="pl-c1">0.2</span>), <span class="pl-v">alpha</span><span class="pl-k">=</span><span class="pl-c1">0.3</span>) <span class="pl-k">+</span>
  labs(<span class="pl-v">title</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>Bank's Sentiment Scores<span class="pl-pds">"</span></span>) <span class="pl-k">+</span> 
  xlab(<span class="pl-s"><span class="pl-pds">'</span>Bank<span class="pl-pds">'</span></span>) <span class="pl-k">+</span> ylab(<span class="pl-s"><span class="pl-pds">'</span>Sentiment Score<span class="pl-pds">'</span></span>)

<span class="pl-c"># barplot of average score</span>
<span class="pl-v">meanscore</span> <span class="pl-k">=</span> tapply(<span class="pl-smi">scores</span><span class="pl-k">$</span><span class="pl-smi">score</span>, <span class="pl-smi">scores</span><span class="pl-k">$</span><span class="pl-smi">bankid</span>, <span class="pl-smi">mean</span>)
<span class="pl-v">df.plot</span> <span class="pl-k">=</span> <span class="pl-k">data.frame</span>(<span class="pl-v">bankid</span><span class="pl-k">=</span>names(<span class="pl-smi">meanscore</span>), <span class="pl-v">meanscore</span><span class="pl-k">=</span><span class="pl-smi">meanscore</span>)
<span class="pl-smi">df.plot</span><span class="pl-k">$</span><span class="pl-smi">bankids</span> <span class="pl-k">&lt;-</span> reorder(<span class="pl-smi">df.plot</span><span class="pl-k">$</span><span class="pl-smi">bankid</span>, <span class="pl-smi">df.plot</span><span class="pl-k">$</span><span class="pl-smi">meanscore</span>)

ggplot(<span class="pl-smi">df.plot</span>, aes(<span class="pl-v">x</span> <span class="pl-k">=</span> <span class="pl-k">factor</span>(<span class="pl-smi">bankids</span>), <span class="pl-v">y</span> <span class="pl-k">=</span> <span class="pl-smi">meanscore</span>, <span class="pl-v">fill</span><span class="pl-k">=</span><span class="pl-smi">bankids</span>)) <span class="pl-k">+</span>
  geom_bar(<span class="pl-v">stat</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>identity<span class="pl-pds">"</span></span>) <span class="pl-k">+</span>
  scale_fill_manual(<span class="pl-v">values</span><span class="pl-k">=</span><span class="pl-smi">cols</span>[order(<span class="pl-smi">df.plot</span><span class="pl-k">$</span><span class="pl-smi">meanscore</span>)]) <span class="pl-k">+</span>
  labs(<span class="pl-v">title</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>Average Sentiment Score<span class="pl-pds">"</span></span>) <span class="pl-k">+</span> 
  xlab(<span class="pl-s"><span class="pl-pds">'</span>Bank<span class="pl-pds">'</span></span>) <span class="pl-k">+</span> ylab(<span class="pl-s"><span class="pl-pds">'</span>Average Score<span class="pl-pds">'</span></span>)

<span class="pl-c"># barplot of average very positive</span>
<span class="pl-v">bankid_pos</span> <span class="pl-k">=</span> ddply(<span class="pl-smi">scores</span>, .(<span class="pl-smi">bankid</span>), <span class="pl-smi">summarise</span>, <span class="pl-v">mean_pos</span><span class="pl-k">=</span>mean(<span class="pl-smi">very.pos</span>))
<span class="pl-smi">bankid_pos</span><span class="pl-k">$</span><span class="pl-smi">bankids</span> <span class="pl-k">&lt;-</span> reorder(<span class="pl-smi">bankid_pos</span><span class="pl-k">$</span><span class="pl-smi">bankid</span>, <span class="pl-smi">bankid_pos</span><span class="pl-k">$</span><span class="pl-smi">mean_pos</span>)

ggplot(<span class="pl-smi">bankid_pos</span>, aes(<span class="pl-v">x</span> <span class="pl-k">=</span> <span class="pl-k">factor</span>(<span class="pl-smi">bankid</span>), <span class="pl-v">y</span> <span class="pl-k">=</span> <span class="pl-smi">mean_pos</span>, <span class="pl-v">fill</span><span class="pl-k">=</span><span class="pl-smi">bankid</span>)) <span class="pl-k">+</span>
  geom_bar(<span class="pl-v">stat</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>identity<span class="pl-pds">"</span></span>) <span class="pl-k">+</span>
  scale_fill_manual(<span class="pl-v">values</span><span class="pl-k">=</span><span class="pl-smi">cols</span>[order(<span class="pl-smi">df.plot</span><span class="pl-k">$</span><span class="pl-smi">meanscore</span>)]) <span class="pl-k">+</span>
  labs(<span class="pl-v">title</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>Average Very Positive Sentiment Score<span class="pl-pds">"</span></span>) <span class="pl-k">+</span> 
  xlab(<span class="pl-s"><span class="pl-pds">'</span>Bank<span class="pl-pds">'</span></span>) <span class="pl-k">+</span> ylab(<span class="pl-s"><span class="pl-pds">'</span>Average Score<span class="pl-pds">'</span></span>)

<span class="pl-c"># barplot of average very negative</span>
<span class="pl-v">bankid_neg</span> <span class="pl-k">=</span> ddply(<span class="pl-smi">scores</span>, .(<span class="pl-smi">bankid</span>), <span class="pl-smi">summarise</span>, <span class="pl-v">mean_neg</span><span class="pl-k">=</span>mean(<span class="pl-smi">very.neg</span>))
<span class="pl-smi">bankid_neg</span><span class="pl-k">$</span><span class="pl-smi">bankids</span> <span class="pl-k">&lt;-</span> reorder(<span class="pl-smi">bankid_neg</span><span class="pl-k">$</span><span class="pl-smi">bankid</span>, <span class="pl-smi">bankid_neg</span><span class="pl-k">$</span><span class="pl-smi">mean_neg</span>)

ggplot(<span class="pl-smi">bankid_neg</span>, aes(<span class="pl-v">x</span> <span class="pl-k">=</span> <span class="pl-k">factor</span>(<span class="pl-smi">bankid</span>), <span class="pl-v">y</span> <span class="pl-k">=</span> <span class="pl-smi">mean_neg</span>, <span class="pl-v">fill</span><span class="pl-k">=</span><span class="pl-smi">bankid</span>)) <span class="pl-k">+</span>
  geom_bar(<span class="pl-v">stat</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>identity<span class="pl-pds">"</span></span>) <span class="pl-k">+</span>
  scale_fill_manual(<span class="pl-v">values</span><span class="pl-k">=</span><span class="pl-smi">cols</span>[order(<span class="pl-smi">df.plot</span><span class="pl-k">$</span><span class="pl-smi">meanscore</span>)]) <span class="pl-k">+</span>
  labs(<span class="pl-v">title</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>Average Very Negative Sentiment Score<span class="pl-pds">"</span></span>) <span class="pl-k">+</span> 
  xlab(<span class="pl-s"><span class="pl-pds">'</span>Bank<span class="pl-pds">'</span></span>) <span class="pl-k">+</span> ylab(<span class="pl-s"><span class="pl-pds">'</span>Average Score<span class="pl-pds">'</span></span>)
</pre></div>

<h2>
<a id="results" class="anchor" href="#results" aria-hidden="true"><span class="octicon octicon-link"></span></a>Results</h2>

<p><strong>Output for Banks:</strong>
<img src="http://i.imgur.com/oRIMQG9.png" alt="">
<img src="http://i.imgur.com/AGgqrSg.png" alt="">
<img src="http://i.imgur.com/OgGvGN3.png" alt="">
<img src="http://i.imgur.com/31KcDjd.png" alt="">
<strong>Output for Topics: (slightly modified R code)</strong>
<img src="http://i.imgur.com/xlYKkN8.png" alt="">
<img src="http://i.imgur.com/Wuvdu4N.png" alt="">
<img src="http://i.imgur.com/vm40bWI.png" alt="">
<img src="http://i.imgur.com/mc7LTaT.png" alt="">
<strong>Output Topics Average by Bank: (slightly modified R code)</strong>
<img src="http://i.imgur.com/Gee9VvM.png" alt="">
<img src="http://i.imgur.com/sBjf9ra.png" alt="">
<img src="http://i.imgur.com/sp7VgqG.png" alt="">
<img src="http://i.imgur.com/15exHME.png" alt=""></p>

<h1>
<a id="report" class="anchor" href="#report" aria-hidden="true"><span class="octicon octicon-link"></span></a>Report</h1>

<p>There truly is no such thing as perfection especially in the banking world. There is always a complaint, an employee error, a problem with something. In today’s day and age, the use of online banking is growing at a stupendous rate and with the emergence of online banking, there is also online feedback twenty-four-seven. The alarming growth of online banking leads to both outstanding achievements of service and productivity, and unfortunately a long list of dissatisfaction ranging from crashed servers to online problems. Naturally the effects of technological advances are either positive or detrimental to the consumer’s outlook on the bank as a whole. The emotionally connections created between the consumer and the bank can either blossom or fall faster than the leaves in autumn. In terms of the plots shown below, sentiment means emotional reaction towards that bank. There are four banks titled, starting from “Bank A” through “Bank D.” Below are visual representations of data that was sifted out of thousands of twitter comments in regard to each bank: 
<img src="http://i.imgur.com/VlSKM57.png" alt="">
This diagram shown above perfectly brings the term “sentiment” to life. As one can see, there is a possibility of a zero sentiment level. Also, there is both positive or negative. “Fraud” is a low sentiment rating on average for every bank, meaning the word “fraud” has the highest percent of average distaste in all the banks. Because this diagram is based off of averages in all the banks, the readings are most valuable when looking at the whole banking field, thus comparing specific bank’s readings compared to the average of all four.</p>

<p>Each respective bank had their own sentiment score which played a factor in the topic sentiment score. That being said, the sentiment score of the banks are all the sentiment scores of each word being compiled into each individual bank and then scored.
<img src="http://i.imgur.com/1w0arTA.png" alt="">
Topics are difficult to determine in a concrete way, meaning that the topics that are shown below are abstract and some tweets didn’t fall into any of these categories.
<img src="http://i.imgur.com/5EXzCOU.png" alt="">
Looking at the figure above, it is clear to see a trend in what topic occurs most often and least often on average for all of the banks. “Online,” is clearly the most used topic when labelling tweets took place. What the topic, “online,” means is that the content of the tweet is referring to online resources for the banks; whereas the topic, “ATM,” refers to tweets exclusively regarding ATM complaints or praises on average in all the banks.</p>

<p>Each bank had their own trends and the most important trend was that of sentiment. The trend of sentiment being used in determining the consumer’s acceptance or the opposite when referring to emotional reactions towards the respective banks.
<img src="http://i.imgur.com/jlU23Cb.png" alt="">
Bank A, as a whole, had the highest sentiment score, meaning that Bank A had the highest consumer satisfaction.</p>

<p>The evidence presented in the form of graphs and plots, is a direct representation of the information that was received via Twitter and each respective plot or graph is determined over the scale of about two hundred thousand tweets. Among the numerous plots and graphs that were created, the four shown above were the most informative and frankly were the most important in terms of visual representation of a group of banks. In these four visual diagrams, there was over two hundred thousand twitter entries regarding at least one of these banks. Surely that is a sample size so small that in a few years that number will have grown exponentially to the point where entries are coming in twenty-four-seven. </p>

<p>With the rise of technology and the use of online banking, the measurement of consumer satisfaction would not be as readily available. Twitter gives the online banking community feedback directly following an incident or situation. This boom of social media has helped the banking community, which is the main piece that online banking is a part of, grow and change their policies, employees, and strategies in the hopes of being as close to a perfect bank as possible.</p>
      </section>
      <footer>
        <p>Project maintained by <a href="https://github.com/thomasberger0308">thomasberger0308</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://twitter.com/michigangraham">mattgraham</a></small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>
